<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REFERENCE - Three.js Particles (Working)</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Arial Black', sans-serif;
        }
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #0f0;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 5px;
            font-size: 12px;
            font-family: monospace;
            z-index: 100;
        }
        #info h3 { margin: 0 0 10px 0; color: #0ff; }
        #info p { margin: 5px 0; }
    </style>
</head>
<body>
    <div id="info">
        <h3>üìã VALORES DE REFERENCIA (WORKING)</h3>
        <p>Camera: (0, 1.5, 6) | FOV: 45</p>
        <p>Scale: 1.5 | Position Y: -1.2</p>
        <p>Particle Size: 0.008 | Opacity: 0.5</p>
        <hr style="border-color: #333; margin: 10px 0;">
        <p style="color: #ff0;">‚ö†Ô∏è Estos valores NO funcionan en R3F</p>
        <p style="color: #0f0;">‚úÖ Usa los valores del IMPLEMENTACION.md</p>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        // ============================================
        // CONFIGURACI√ìN EXACTA DEL INDEX.HTML ORIGINAL
        // ============================================
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.5, 6);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.appendChild(renderer.domElement);

        // Loader
        const loader = new GLTFLoader();
        const models = [];

        // ============================================
        // FUNCI√ìN: CREAR PART√çCULAS (ORIGINAL)
        // ============================================
        function createParticles(gltf, posX, color, skipVertices = 1) {
            const vertices = [];
            
            gltf.scene.updateMatrixWorld(); // ‚ö†Ô∏è ESTO ES LO QUE FALLA EN R3F

            gltf.scene.traverse((child) => {
                if (child.isMesh) {
                    const positions = child.geometry.attributes.position.array;
                    
                    for (let i = 0; i < positions.length; i += (3 * skipVertices)) {
                        const v = new THREE.Vector3(positions[i], positions[i + 1], positions[i + 2]);
                        child.localToWorld(v);
                        vertices.push(v.x, v.y, v.z);
                    }
                }
            });

            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));

            const material = new THREE.PointsMaterial({
                color: color,
                size: 0.008,
                transparent: true,
                opacity: 0.5,
                blending: THREE.AdditiveBlending,
                depthWrite: false,
                sizeAttenuation: true
            });

            const points = new THREE.Points(geometry, material);
            points.position.set(posX, -1.2, 0);
            points.scale.set(1.5, 1.5, 1.5);

            scene.add(points);
            models.push(points);

            console.log(`‚úÖ Loaded: ${vertices.length / 3} points at posX=${posX}`);
        }

        // ============================================
        // CARGAR MODELOS
        // ============================================
        // ‚ö†Ô∏è AJUSTA ESTAS RUTAS A TUS ARCHIVOS
        loader.load(
            '../frontend/public/images/Landing/Cs2_agent.glb',
            (gltf) => createParticles(gltf, -2.5, 0x00aaff, 2),
            undefined,
            (error) => console.error('Error loading agent:', error)
        );

        loader.load(
            '../frontend/public/images/Landing/cs2_terrorist.glb',
            (gltf) => createParticles(gltf, 2.5, 0xffbb00, 1),
            undefined,
            (error) => console.error('Error loading terrorist:', error)
        );

        // ============================================
        // ANIMACI√ìN
        // ============================================
        function animate() {
            requestAnimationFrame(animate);
            
            models.forEach(model => {
                model.rotation.y += 0.003;
            });

            renderer.render(scene, camera);
        }

        animate();

        // ============================================
        // RESIZE HANDLER
        // ============================================
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
